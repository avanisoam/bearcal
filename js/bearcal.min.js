(function(){(function(c,b,a){return c.widget("a07.BearCal",{options:{startDate:new Date(),period:12,scrollPeriod:4,monthFullName:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],nthMonth:4,nthMonthClass:"endrow",animateSpeed:500,nextMonthsHtml:function(){return'<a href="#" class="next_months">Next '+this.scrollPeriod+" months</a>"},prevMonthsHtml:function(){return'<a href="#" class="prev_months">Previous '+this.scrollPeriod+" months</a>"},boxClass:{am:"am_box",pm:"pm_box",fullDay:"day_box"},trackClass:"track",defaultStatusType:"available",reverseTypes:{available:"unavailable",unavailable:"available"},hoverStates:{am:{available:"hover_available_am",unavailable:"hover_unavailable_am"},pm:{available:"hover_available_pm",unavailable:"hover_unavailable_pm"}},highlightStates:{am:{available:"highlight_available_am",unavailable:"highlight_unavailable_am"},pm:{available:"highlight_available_pm",unavailable:"highlight_unavailable_pm"}},setStates:{am:{available:"",unavailable:"unavailable am",booked:"booked am",delimiter:"delimiter_am"},pm:{available:"",unavailable:"unavailable pm",booked:"booked pm",delimiter:"delimiter_pm"}},json:false,jsonUrl:"",dontTrackStates:["booked"]},_options:{loadedData:{},loadedMonths:[],displayedMonths:[],startDate:null,endDate:null,state:null},getJSON:function(){var d,e;e=this;d={availability:[]};this.element.find("."+this.options.boxClass.fullDay).each(function(){var f;f=c(this);d.availability.push({date:f.find("."+e.options.boxClass.am).attr("data-date"),type:f.find("."+e.options.boxClass.am).attr("data-status-type"),delimiter:f.find("."+e.options.boxClass.am).attr("data-delimiter")});return d.availability.push({date:f.find("."+e.options.boxClass.pm).attr("data-date"),type:f.find("."+e.options.boxClass.pm).attr("data-status-type"),delimiter:f.find("."+e.options.boxClass.pm).attr("data-delimiter")})});return JSON.stringify(d,null,"\t")},_compareDates:function(f,d,e){f=this._parseDate(f);d=this._parseDate(d);switch(e){case"<":return new Date(f).getTime()<new Date(d).getTime();case">":return new Date(f).getTime()>new Date(d).getTime();case">=":return new Date(f).getTime()>=new Date(d).getTime();case"<=":return new Date(f).getTime()<=new Date(d).getTime();case"==":return new Date(f).getTime()===new Date(d).getTime()}},_parseDate:function(j){var f,i,e,h,g;e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];g=j.slice(0,4);i=e[j.slice(5,7)-1];f=j.slice(8,10);h=j.slice(-8,j.length);return""+i+" "+f+", "+g+" "+h},_trackable:function(d){if(c.inArray(d.attr("data-status-type"),this.options.dontTrackStates)===-1){return true}else{return false}},_track:function(){var d;d=this;return c("."+this.element.attr("class")).on({mousemove:function(g){var h,i,f,e;f=c(this).find("div");h=c(this).find("."+d.options.boxClass.am);e=c(this).find("."+d.options.boxClass.pm);if(d._getLocation(this,g)){if(!d._highlightable()){f.removeClass(d._getAllClasses(d.options.hoverStates));i=d._getReverseType(h);return h.addClass(d.options.hoverStates.am[i])}else{d._eraseHighlights();return d._trackHighlights(this,"T00:00:00")}}else{if(!d._highlightable()){f.removeClass(d._getAllClasses(d.options.hoverStates));i=d._getReverseType(e);return e.addClass(d.options.hoverStates.pm[i])}else{d._eraseHighlights();return d._trackHighlights(this,"T12:00:00")}}},mouseleave:function(f){var e;e=c(this).find("div");return e.removeClass(d._getAllClasses(d.options.hoverStates))},click:function(f){var g,e;g=c(this).find("."+d.options.boxClass.am);e=c(this).find("."+d.options.boxClass.pm);if(d._getLocation(this,f)){if(d._trackable(g)){return d._setDates(this,"T00:00:00")}}else{if(d._trackable(e)){return d._setDates(this,"T12:00:00")}}}},"."+this.options.trackClass)},_getLocation:function(f,e){var d,g;g=c(f).offset();d=c(f).height()+g.top;return(d-e.pageY)>(e.pageX-g.left)},_highlightable:function(){return this._options.startDate&&!this._options.endDate},_eraseHighlights:function(){return c("."+this.options.boxClass.am+", ."+this.options.boxClass.pm).removeClass(this._getAllClasses(this.options.highlightStates))},_getReverseType:function(d){return this.options.reverseTypes[c(d).attr("data-status-type")]},_trackHighlights:function(e,h,d){var g,f;f=this;g=c(e).attr("data-date")+h;return c("."+this.options.boxClass.fullDay).each(function(){var l,j,i,k;if(g<f._options.startDate){j=c(e).attr("data-date")+"T00:00:00";i=c(this).attr("data-date")+"T00:00:00";if(f._compareDates(i,j,">=")&&f._compareDates(i,f._options.startDate,"<=")){l=c(this).find("."+f.options.boxClass.am);k=c(this).find("."+f.options.boxClass.pm);if(f._compareDates(i,j,"==")&&~g.indexOf("T12:00:00")){if(f._trackable(k)){return k.addClass(f.options.highlightStates.pm[f._options.state])}}else{if(f._compareDates(i,f._options.startDate,"==")){if(f._trackable(l)){return l.addClass(f.options.highlightStates.am[f._options.state])}}else{if(f._trackable(l)){l.addClass(f.options.highlightStates.am[f._options.state])}if(f._trackable(k)){return k.addClass(f.options.highlightStates.pm[f._options.state])}}}}}else{if(g>f._options.startDate){j=c(e).attr("data-date")+"T12:00:00";i=c(this).attr("data-date")+"T12:00:00";if(f._compareDates(i,j,"<=")&&f._compareDates(i,f._options.startDate,">=")){l=c(this).find("."+f.options.boxClass.am);k=c(this).find("."+f.options.boxClass.pm);if(f._compareDates(i,j,"==")&&~g.indexOf("T00:00:00")){if(f._trackable(l)){return c(this).find("."+f.options.boxClass.am).addClass(f.options.highlightStates.am[f._options.state])}}else{if(f._compareDates(i,f._options.startDate,"==")){if(f._trackable(k)){return c(this).find("."+f.options.boxClass.pm).addClass(f.options.highlightStates.pm[f._options.state])}}else{if(f._trackable(l)){c(this).find("."+f.options.boxClass.am).addClass(f.options.highlightStates.am[f._options.state])}if(f._trackable(k)){return c(this).find("."+f.options.boxClass.pm).addClass(f.options.highlightStates.pm[f._options.state])}}}}}else{if(g===f._options.startDate){l=c(this).find("."+f.options.boxClass.am);k=c(this).find("."+f.options.boxClass.pm);i=c(this).attr("data-date")+"T00:00:00";if(f._compareDates(i,g,"==")){if(f._trackable(l)){c(this).find("."+f.options.boxClass.am).addClass(f.options.highlightStates.am[f._options.state])}}i=c(this).attr("data-date")+"T12:00:00";if(f._compareDates(i,g,"==")){if(f._trackable(k)){return c(this).find("."+f.options.boxClass.pm).addClass(f.options.highlightStates.pm[f._options.state])}}}}}})},_setDates:function(d,f){var e;e=this;if(this._options.startDate&&this._options.endDate){this._options.startDate=this._options.endDate=this._options.state=null}if(this._options.startDate){this._options.endDate=c(d).attr("data-date")+f;if(this._compareDates(this._options.startDate,this._options.endDate,"<")){c("."+this.options.boxClass.fullDay).each(function(){var h,g;h=c(this).find("."+e.options.boxClass.am);g=c(this).find("."+e.options.boxClass.pm);if(e._compareDates(e._options.startDate,c(this).attr("data-date")+"T12:00:00","<")&&e._compareDates(e._options.endDate,c(this).attr("data-date")+"T00:00:00",">")){if(e._trackable(h)){h.removeClass(e._getAllClasses(e.options.setStates)).addClass(e.options.setStates.am[e._options.state]).attr("data-status-type",e._options.state)}if(e._trackable(g)){return g.removeClass(e._getAllClasses(e.options.setStates)).addClass(e.options.setStates.pm[e._options.state]).attr("data-status-type",e._options.state)}}else{if(e._compareDates(e._options.startDate,c(this).attr("data-date")+"T12:00:00","==")){if(e._trackable(g)){return g.removeClass(e._getAllClasses(e.options.setStates)).addClass(e.options.setStates.pm.delimiter+" "+e.options.setStates.pm[e._options.state]).attr("data-status-type",e._options.state).attr("data-delimiter","true")}}else{if(e._compareDates(e._options.endDate,c(this).attr("data-date")+"T00:00:00","==")){if(e._trackable(h)){return h.removeClass(e._getAllClasses(e.options.setStates)).addClass(e.options.setStates.am.delimiter+" "+e.options.setStates.am[e._options.state]).attr("data-status-type",e._options.state).attr("data-delimiter","true")}}}}});this._eraseHighlights();return true}else{if(this._compareDates(this._options.startDate,this._options.endDate,">")){c("."+this.options.boxClass.fullDay).each(function(){var h,g;h=c(this).find("."+e.options.boxClass.am);g=c(this).find("."+e.options.boxClass.pm);if(e._compareDates(e._options.startDate,c(this).attr("data-date")+"T00:00:00",">")&&e._compareDates(e._options.endDate,c(this).attr("data-date")+"T12:00:00","<")){if(e._trackable(h)){h.removeClass(e._getAllClasses(e.options.setStates)).addClass(e.options.setStates.am[e._options.state]).attr("data-status-type",e._options.state)}if(e._trackable(g)){return g.removeClass(e._getAllClasses(e.options.setStates)).addClass(e.options.setStates.pm[e._options.state]).attr("data-status-type",e._options.state)}}else{if(e._compareDates(e._options.startDate,c(this).attr("data-date")+"T00:00:00","==")){if(e._trackable(h)){return h.removeClass(e._getAllClasses(e.options.setStates)).addClass(e.options.setStates.am.delimiter+" "+e.options.setStates.am[e._options.state]).attr("data-status-type",e._options.state).attr("data-delimiter","true")}}else{if(e._compareDates(e._options.endDate,c(this).attr("data-date")+"T12:00:00","==")){if(e._trackable(g)){return g.removeClass(e._getAllClasses(e.options.setStates)).addClass(e.options.setStates.pm.delimiter+" "+e.options.setStates.pm[e._options.state]).attr("data-status-type",e._options.state).attr("data-delimiter","true")}}}}});this._eraseHighlights();return true}else{c("."+this.options.boxClass.fullDay).each(function(){var h,g;h=c(this).find("."+e.options.boxClass.am);g=c(this).find("."+e.options.boxClass.pm);if(e._compareDates(e._options.startDate,c(this).attr("data-date")+"T00:00:00","==")){if(e._trackable(h)){return h.removeClass(e._getAllClasses(e.options.setStates)).addClass(e.options.setStates.am.delimiter+" "+e.options.setStates.am[e._options.state]).attr("data-status-type",e._options.state).attr("data-delimiter","true")}}else{if(e._compareDates(e._options.startDate,c(this).attr("data-date")+"T12:00:00","==")){if(e._trackable(g)){return g.removeClass(e._getAllClasses(e.options.setStates)).addClass(e.options.setStates.pm.delimiter+" "+e.options.setStates.pm[e._options.state]).attr("data-status-type",e._options.state).attr("data-delimiter","true")}}}});return true}}}else{this._options.startDate=c(d).attr("data-date")+f;this._options.state=f==="T00:00:00"?e._getReverseType(c(d).find("."+e.options.boxClass.am)):e._getReverseType(c(d).find("."+e.options.boxClass.pm));return false}},_getAllClasses:function(e){var d,f;f=this;d="";c.each(e,function(g,h){if(e[g] instanceof Object){return d+=f._getAllClasses(e[g])}else{return d+=h+" "}});return d},_toDate:function(d){return new Date(d)},_setDate:function(){var d;if(typeof this.options.startDate!=="object"){d=this.options.startDate.split("/");return this.options.startDate=new Date(d[0],d[1],d[2])}},_getDayOfWeek:function(e,f,d){return new Date(e,f,d).getDay()},_getDaysInMonth:function(d,e){return new Date(d,e+1,0).getDate()},_getWeekdaysHtml:function(){var e,h,g,d,f;h="";f=this.options.days;for(g=0,d=f.length;g<d;g++){e=f[g];h+='<div class="wday_box">'+(e.charAt(0))+"</div>\n"}return h},_getDaysHtml:function(n,m){var d,g,f,e,l,p,j,h,o,k;f="";g=0;d=this._getDayOfWeek(n,m,1);if(d>0){l=0;while(l<d){f+='<div class="empty_day_box"></div>';g++;l++}}p={};l=0;while(l<this._getDaysInMonth(n,m)){p={am:{type:this.options.defaultStatusType,delimiter:"false"},pm:{type:this.options.defaultStatusType,delimiter:"false"}};e=""+n+"-"+(this._pad(parseInt(m)+1,2))+"-"+(this._pad(l+1,2));if(this._options.loadedData.availability!=null){k=this._options.loadedData.availability;for(h=0,o=k.length;h<o;h++){j=k[h];if(j.date===e+"T00:00:00"){p.am.type=j.type;p.am.delimiter=j.delimiter}else{if(j.date===e+"T12:00:00"){p.pm.type=j.type;p.pm.delimiter=j.delimiter}}}}f+='<div class="'+this.options.boxClass.fullDay+" "+this.options.trackClass+'" data-date="'+e+'">\n  <div class="'+this.options.boxClass.am+" "+this.options.setStates.am[p.am.type]+" "+(p.am.delimiter==="true"?this.options.setStates.am.delimiter:"")+'" data-date="'+e+'T00:00:00" data-status-type="'+p.am.type+'" data-delimiter="'+p.am.delimiter+'">\n    <div class="'+this.options.boxClass.pm+" "+this.options.setStates.pm[p.pm.type]+" "+(p.pm.delimiter==="true"?this.options.setStates.pm.delimiter:"")+'" data-date="'+e+'T12:00:00" data-status-type="'+p.pm.type+'" data-delimiter="'+p.pm.delimiter+'">\n      '+(l+1)+"\n    </div>\n  </div>\n</div>";g++;l++}while(g<42){f+='<div class="empty_day_box"></div>';g++}return f},_pad:function(e,d){var f;f=d-e.toString().length+1;return Array(+(f>0&&f)).join("0")+e},_getMonth:function(d,f){var e;this._setLoadedMonths(d,f);if(this._options.displayedMonths.length<this.options.period){this._setDisplayedMonths(d,f)}e=this._options.loadedMonths.length%this.options.nthMonth;return'<div class="month_box '+(e===0?this.options.nthMonthClass:"")+'">\n  <div class="month_header">'+this.options.monthFullName[f]+" "+d+'</div>\n  <div class="month_wrapper">\n    '+(this._getWeekdaysHtml())+"\n    "+(this._getDaysHtml(d,f))+"\n  </div>\n</div>"},_setLoadedMonths:function(d,e){this._options.loadedMonths.push(d+"-"+e);return this._options.loadedMonths.sort(this._dateCompare)},_setDisplayedMonths:function(d,f,e){this._options.displayedMonths.push(d+"-"+f);this._options.displayedMonths.sort(this._dateCompare);if(typeof e!=="undefined"){if(e===-1){this._options.displayedMonths.pop()}if(e===1){return this._options.displayedMonths.shift()}}},_dateCompare:function(e,d){e=e.split("-");d=d.split("-");return(new Date(e[0],e[1]).getTime())-(new Date(d[0],d[1]).getTime())},_getCalendar:function(){var g,d,f,e;this._trigger("beforebuild");g=this.options.prevMonthsHtml();g+='<div class="year_box clearfix">\n  <div class="slider_container clearfix">\n';e=this.options.startDate.getFullYear();f=this.options.startDate.getMonth();d=0;while(d<this.options.period){if(f>11){f=0;e++}g+=this._getMonth(e,f);f++;d++}g+="</div></div>";return g+=this.options.nextMonthsHtml()},_getMonthsByPeriod:function(n,l,m){var e,k,j,d,q,h,g,f,p,o;d=m<0?-1:1;j=Math.abs(m);h=[];k="";while(j!==0){l+=d;g=l%12;o=g<0?g+12:g;if(d===-1){n=o===11?n+d:n}else{n=o===0?n+d:n}h.push(n+"-"+o);--j}if(d===-1){h.reverse()}for(f=0,p=h.length;f<p;f++){q=h[f];e=q.split("-");if(~c.inArray(q,this._options.loadedMonths)===0){k+=this._getMonth(e[0],e[1])}this._setDisplayedMonths(e[0],e[1],d)}return k},_splitDate:function(e,g){var d,f;d=g[e].split("-");f=0;while(f<d.length){d[f]=parseInt(d[f]);f++}return d},_getPrevMonths:function(){var d,i,e,f,h,g;if(!c(".slider_container").is(":animated")){i=parseFloat(c(".slider_container").css("marginTop"));h=c(".month_box").outerHeight(true);g=this.options.scrollPeriod/this.options.nthMonth;d=i+(h*g);d=d===(h*g)?0:d;e=this._splitDate(0,this._options.displayedMonths);f=this._getMonthsByPeriod(e[0],e[1],-this.options.scrollPeriod);if(f.length>0){return c(".slider_container").prepend(f).css({marginTop:(i-(h*g))+"px"}).animate({marginTop:d+"px"},this.options.animateSpeed)}else{return c(".slider_container").animate({marginTop:d+"px"},this.options.animateSpeed)}}},_getNextMonths:function(){var d,h,e,g,f;if(!c(".slider_container").is(":animated")){h=parseFloat(c(".slider_container").css("marginTop"));g=c(".month_box").outerHeight(true);f=this.options.scrollPeriod/this.options.nthMonth;d=h-(g*f);e=this._splitDate(this._options.displayedMonths.length-1,this._options.displayedMonths);return c(".slider_container").append(this._getMonthsByPeriod(e[0],e[1],this.options.scrollPeriod)).animate({marginTop:d+"px"},this.options.animateSpeed)}},_startup:function(){var d=this;this.element.append(this._getCalendar());c(".prev_months").click(function(){d._getPrevMonths();return false});c(".next_months").click(function(){d._getNextMonths();return false});return this._track()},_create:function(){var d;d=this;if(this.options.json){return c.getJSON(this.options.jsonUrl,function(e){c.extend(d._options.loadedData,e);return d._startup()})}else{return d._startup()}},_init:function(){var d;d=this;return this._setDate()},destroy:function(){},_setOption:function(d,e){}})})(jQuery,window,document)}).call(this);
